import{Connection as _,JsonRpcProvider as F,SUI_TYPE_ARG as E}from"@mysten/sui.js";import{newBN as m,sumBN as A}from"./bigNumber.js";import K,{isBagNFT as G}from"./getBagNFT.js";import{DEFAULT_NETWORK as $}from"./constants.js";import J from"./getDisplay.js";import{getKioskObjects as L,isKiosk as Y}from"./getKioskNFT.js";const q=s=>s?s.indexOf("ipfs")===0?s.replace(/^ipfs:\/\//,"https://ipfs.io/ipfs/"):s:"",v={suiBalance:m(0),balances:{},nfts:[],tokens:{},objects:[]},z=async({address:s,network:D,existingContents:u})=>{try{const y=new _({fullnode:D||$}),d=new F(y);if(!s)return v;const P=await d.getAllBalances({owner:s});let a=[],O,c,x=0,h=!1;for(;c!==null;){x+=1;const e=await d.getOwnedObjects({owner:s,options:{showType:!0,showOwner:!0,showContent:!0,showDisplay:!0},cursor:c});a=[...a,...e.data],h=e.hasNextPage,O=e.nextCursor??void 0,x>20?c=null:h?c=O??null:c=null}if(a.length===0)return u===v?null:v;const T=[];let f=[];if(u?.objects&&u.objects.length>0)for(const e of a){if(!e.data||e.error)continue;const o=u?.objects.find(l=>typeof e.data=="object"?l.objectId===e.data.objectId&&l.version.toString()===e.data.version.toString():!1);o?T.push(o):f.push(e.data)}else f=a.filter(e=>!!e.data&&!e.error).map(e=>e.data);if(f.length===0)return null;const U=f,C=T.concat(U);let R=m(0);const W=P.reduce((e,o)=>(e[o.coinType]=o,o.coinType===E&&(R=m(o.totalBalance)),e),{});let w=[];for(const e of C)Y(e)&&(w=[...w,...await L(d,e)]);for(const e of w)e.data&&C.push(e.data);const k=[],r={},B=[];for(const e of C){const{display:o,content:l}=e,{fields:n}=l?.dataType==="moveObject"?l:{fields:{}},t=J(o);try{const b=(e.type||"").split("<"),i=(b[1]||"").replace(/>/,""),j=b[0].split("::"),S=j[0],I=j[1],p=j[j.length-1],g=q(t?.image_url??t?.img_url??t?.url??n?.url??n?.image_url??n?.img_url);if(B.push({...e,packageObjectId:S,moduleName:I,structName:p,name:t?.name??n?.name,description:t?.description??n?.description,imageUrl:g,display:t,fields:n,isCoin:p==="Coin"}),p==="Coin")r[i]||(r[i]={balance:0,coins:[]}),r[i].balance=A(r[i].balance,n.balance),r[i].coins.push({objectId:e?.objectId,type:e?.type,balance:m(n.balance),digest:e?.digest,version:e?.version,display:t});else if(G(e)){const N=await K(d,e);"name"in N&&k.push({type:e.type??"unknown",packageObjectId:S,moduleName:I,structName:p,chain:"Sui",address:e?.objectId,objectId:e?.objectId,name:t?.name??N.name,description:t?.description??N.description,imageUrl:g,link:t?.link,creator:t?.creator,projectUrl:t?.project_url,display:t,links:{Explorer:`https://explorer.sui.io/objects/${e.objectId}`}})}else g&&k.push({type:e.type??"Unknown",packageObjectId:S,moduleName:I,structName:p,chain:"Sui",address:e?.objectId,objectId:e?.objectId,name:t?.name??n?.name,description:t?.description??n?.description,imageUrl:g,link:t?.link,creator:t?.creator,projectUrl:t?.project_url,display:t,fields:n,links:{Explorer:`https://explorer.sui.io/objects/${e.objectId}`}})}catch(b){console.log("Error retrieving object",e,b)}}return{suiBalance:R,balances:W,tokens:r,nfts:k,objects:B,hasNextPage:h,nextCursor:O??void 0}}catch(y){return console.log("Error retrieving wallet contents",y),null}};var le=z;export{le as default,q as ipfsConversion};
