import a from"store2";import w from"./getConfiguration.js";import g from"./log.js";import I from"./postIFrameMessage.js";const b=f=>{const{apiKey:l,walletAppUrl:r,network:u}=w();if(g("getIframe","getIframe",l,r),!l||!r)return;const p="ethos-wallet-iframe";let c=0,e=document.getElementById(p);const d=()=>{!e||(e.style.width="1px",e.style.height="1px")},s=new URLSearchParams(window.location.search),i=s.get("access_token"),m=s.get("refresh_token");let o=r+`/wallet?apiKey=${l}&network=${u}`;if(i&&m){o+=`&access_token=${i}&refresh_token=${m}`,s.delete("access_token"),s.delete("refresh_token");let t=location.protocol+"//"+location.host+location.pathname;s.toString().length>0&&(t+="?"+s.toString()),a.namespace("auth")("access_token",i),a.namespace("auth")("refresh_token",m),window.history.pushState({},"",t)}else{const t=a.namespace("auth")("access_token"),n=a.namespace("auth")("refresh_token");t&&n&&(o+=`&access_token=${t}&refresh_token=${n}`)}return e?e.src!==o&&(e.src=o):(g("getIframe","Load Iframe",o),e=document.createElement("IFRAME"),e.src=o,e.id=p,e.style.border="none",e.style.position="absolute",e.style.top=c-1+"px",e.style.right="60px",e.style.width="1px",e.style.height="1px",e.style.zIndex="99",e.style.backgroundColor="transparent",e.setAttribute("allow","payment; clipboard-read; clipboard-write"),document.body.appendChild(e),window.addEventListener("message",t=>{if(t.origin===r){const{action:n}=t.data;switch(n){case"close":d();break;case"ready":e.setAttribute("readyToReceiveMessages","true");const h=a.namespace("iframeMessages"),y=h("messages")||[];for(const k of y)I(k);h("messages",null);break}}}),window.addEventListener("scroll",()=>{c=window.scrollY,e.style.top=c+"px"})),f?(e.style.width="360px",e.style.height="600px"):f!==void 0&&d(),e};var T=b;export{T as default};
