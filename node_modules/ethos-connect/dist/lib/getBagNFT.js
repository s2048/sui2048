import{getObjectFields as o,is as y,SuiObjectData as D}from"@mysten/sui.js";import a from"lodash";import{ipfsConversion as R}from"../lib/getWalletContents.js";const l=/(0x[a-f0-9]{39,40})::nft::Nft<0x[a-f0-9]{39,40}::([a-zA-Z]{1,})::([a-zA-Z]{1,})>/,b=/0x2::dynamic_field::Field<(0x[a-f0-9]{39,40})::utils::Marker<(0x[a-f0-9]{39,40})::display::UrlDomain>, (0x[a-f0-9]{39,40})::display::UrlDomain>/,j=/0x2::dynamic_field::Field<(0x[a-f0-9]{39,40})::utils::Marker<(0x[a-f0-9]{39,40})::display::DisplayDomain>, (0x[a-f0-9]{39,40})::display::DisplayDomain>/,d="reference.objectId",f="data.fields.bag.fields.id.id",g="data.fields.logical_owner",_={parser:(t,e,s)=>{if(typeof s.data=="object"&&"owner"in s.data){const{owner:n}=s.data,i=e.content.type.match(l);if(!i)return;const p=i[1],r=i[2],c=i[3];return{owner:n,type:e.content?.dataType,id:s.data.objectId,packageObjectId:p,packageModule:r,packageModuleClassName:c,rawResponse:s,logicalOwner:t.logical_owner,bagId:t.bag.fields.id.id}}},regex:l},u=(t,e)=>{const{data:s}=t;if(y(s,D)){const{content:n}=s;if(n&&"type"in n)return n.type.match(e)}return!1},x=t=>{const e={},s=t.find(i=>u(i,b)),n=t.find(i=>u(i,j));if(s&&o(s)){const i=o(s).value.fields.url;e.url=R(i)}return n&&o(n)&&(e.description=o(n).value.fields.description,e.name=o(n).value.fields.name),e},O=t=>!!t.content&&"fields"in t.content&&"logical_owner"in t.content.fields&&"bag"in t.content.fields,w=async(t,e)=>{if(!O(e)||!a.has(e,d)||!a.has(e,f)||!a.has(e,g))return e;const s=a.get(e,d),n=a.get(e,f),i=a.get(e,g),r=(await t.getDynamicFields({parentId:n||""})).data.map(m=>m.objectId),c=await t.multiGetObjects({ids:r,options:{showContent:!0,showDisplay:!0,showOwner:!0,showType:!0}});return{id:s,owner:i,...x(c)}};var P=w;export{_ as NftParser,P as default,O as isBagNFT,x as parseDomains};
