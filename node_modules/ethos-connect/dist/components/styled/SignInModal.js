import t,{useCallback as S,useEffect as f,useMemo as h,useState as l}from"react";import ot from"../svg/Loader.js";import _ from"../svg/WalletsIcon.js";import*as g from"./signInModalStyles.js";import et from"../../lib/useHandleElementWithIdClicked.js";import lt from"./EmailSent.js";import nt from"./Wallets.js";import P from"./Email.js";import it from"./Dialog.js";import st from"./ModalWrapper.js";import at from"./InstallWallet.js";import M from"./IconButton.js";import b from"../../hooks/hooks.js";import rt from"./MobileWallet.js";import T from"./Header.js";import Y from"./Or.js";import $ from"../../lib/log.js";function Et(){window.ethosInternal.showSignInModal()}function xt(){window.ethosInternal.hideSignInModal()}const dt=({connectMessage:u,dappName:j,dappIcon:y,hideEmailSignIn:a,hideWalletSignIn:r,externalContext:C,preferredWallets:i})=>{const{wallets:O,selectWallet:q}=C?.wallet||b.useWallet(),{isModalOpen:w,openModal:k,closeModal:d}=C?.modal||b.useModal(),[E,x]=l(w),[z,v]=l(!1),[F,A]=l(!1),{width:e}=b.useWindowDimensions(),D="ethos-close-on-click",[H,N]=l(!1),[m,G]=l(!1),[p,B]=l(!1),[n,J]=l(j),[s,K]=l();et(D,d),f(()=>{window.ethosInternal||(window.ethosInternal={}),window.ethosInternal.showSignInModal=()=>{k()},window.ethosInternal.hideSignInModal=()=>{d()},x(w)},[w,x,k,d]),f(()=>{if(a&&r)throw new Error("hideEmailSignIn and hideWalletSignIn cannot both be true")},[a,r]),f(()=>{n||J(document.title)},[n]),f(()=>{let o=O||[];i&&i.length>0&&(o=o.sort((R,tt)=>{let c=i.indexOf(R.name);c===-1&&(c=o.length);let W=i.indexOf(tt.name);return W===-1&&(W=o.length),c-W})),$("preferredWallets",i,o),K(o)},[O,i,$]);const Q=S(()=>{B(o=>!o)},[]),L=S(()=>{N(o=>!o)},[]),U=S(()=>{B(!1),G(!1),N(!1)},[]),I=h(()=>u||(n?t.createElement(t.Fragment,null,"Connect to ",t.createElement("span",{style:g.highlighted()},n)):t.createElement(t.Fragment,null)),[n,u]),V=h(()=>s?m?t.createElement(rt,null):p||a&&s.length===0?t.createElement(at,{width:e}):r?t.createElement(P,{setSigningIn:v,setEmailSent:A,width:e}):!H&&s.length>0?t.createElement(T,{title:I,dappIcon:y,subTitle:"Choose from your installed wallets"},t.createElement(nt,{wallets:s,selectWallet:q,width:e}),!a&&t.createElement(t.Fragment,null,t.createElement(Y,null),t.createElement("div",{style:g.submitButtonContainer()},t.createElement(M,{text:"Sign In With Email",onClick:L,width:e,primary:!0})))):t.createElement(T,{title:I,dappIcon:y,subTitle:`Log in to ${n}`},t.createElement(P,{setSigningIn:v,setEmailSent:A,width:e}),!r&&t.createElement(t.Fragment,null,t.createElement(Y,null),t.createElement("div",{style:g.submitButtonContainer()},s.length>0?t.createElement(M,{icon:t.createElement(_,null),text:"Select One Of Your Wallets",onClick:L,width:e}):t.createElement(M,{icon:t.createElement(_,null),text:"Install A Wallet",onClick:Q,width:e})))):t.createElement(t.Fragment,null),[I,n,a,r,s,H,m,p]),X=h(()=>m||p,[m,p]),Z=h(()=>t.createElement("div",{style:g.loaderStyle()},t.createElement(ot,{width:50})),[]);return t.createElement(it,{isOpenAll:E},t.createElement(st,{closeOnClickId:D,onClose:d,isOpenAll:E,width:e,back:X?U:null},F?t.createElement(lt,null):z?Z:V))};var vt=dt;export{vt as default,xt as hideSignInModal,Et as showSignInModal};
